function fillTable(id, date, invoice, payment) {
  const confirmUrl = BASE_URL + "/support/orders/edit/" + id;
  var tableElement = `<tr data-href="${confirmUrl}">
                <td>${date}</td>
                <td>${invoice}</td>
                <td><span class="${
                  payment == 1 ? "badge badge-success" : "badge badge-danger"
                }">${payment == 1 ? "Terbayar" : "Belum Dibayar"}</span></td>
              </tr>`;
  return tableElement;
}

function orderPerMonth(month, total) {
  var options = {
    chart: {
      type: "bar",
    },
    series: [
      {
        name: "sales",
        data: total,
      },
    ],
    xaxis: {
      categories: month,
    },
  };

  var chart = new ApexCharts(document.querySelector("#chart"), options);

  chart.render();
}

function chartTest(status, total, all) {
  const options = {
    chart: {
      type: "donut",
    },
    series: total,
    labels: status,
    plotOptions: {
      pie: {
        donut: {
          size: "70%",
          labels: {
            show: true,
            total: {
              show: true,
              label: "Total",
              fontSize: "22px",
              fontWeight: 600,
              formatter: () => all, // menampilkan total di tengah
            },
          },
        },
      },
    },
    dataLabels: {
      enabled: true,
      formatter: function (val, opts) {
        return (
          opts.w.globals.labels[opts.seriesIndex] + ": " + val.toFixed(1) + "%"
        );
      },
    },
    tooltip: {
      y: {
        formatter: function (val) {
          return val;
        },
      },
    },
  };

  const chart = new ApexCharts(document.querySelector("#donut-chart"), options);
  chart.render();
}

$("table tbody").on("click", "tr", function () {
  const href = $(this).data("href");
  if (href) {
    window.open(href, "_self"); // buka di tab yang sama
  }
});

$(document).ready(function () {
  var trTable = "";

  $.ajax({
    url: HOST_URL + "/getUnconfirmedOrder",
    type: "GET",
    data: {},
    success: function (response) {
      $.each(response.rows, function (index, item) {
        trTable += fillTable(
          item.id,
          item.created_at,
          item.invoice,
          item.payment
        );
      });

      $("table tbody").html(trTable);
    },
    error: function (xhr, status, error) {
      console.error(error);
    },
  });

  $.ajax({
    url: HOST_URL + "/getAllUserTest",
    type: "GET",
    data: {},
    success: function (response) {
      chartTest(response.status, response.total, response.all);
    },
    error: function (xhr, status, error) {
      console.error(error);
    },
  });

  $.ajax({
    url: HOST_URL + "/getOrderPerMonth",
    type: "GET",
    data: {},
    success: function (response) {
      orderPerMonth(response.month, response.total);
    },
    error: function (xhr, status, error) {
      console.error(error);
    },
  });
});
